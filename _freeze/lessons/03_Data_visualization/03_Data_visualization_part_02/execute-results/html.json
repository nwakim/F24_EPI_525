{
  "hash": "5e1f4b94ea85a80f6c84d3b0243cdbb3",
  "result": {
    "markdown": "---\ntitle: \"Day 3: Data visualization - Part 2\"\ndate: \"10/4/2023\"\ncategories: [\"Week 2\"]\nauthor: \"Meike Niederhausen and Nicky Wakim\"\ntitle-slide-attributes:\n    data-background-color: \"#3070BF\"\nformat: \n  revealjs:\n    theme: \"../simple_NW.scss\"\n    toc: true\n    toc-depth: 1\n    toc-title: Class Overview\n    chalkboard: true\n    slide-number: true\n    show-slide-number: all\n    width: 1600\n    height: 1100\n    footer: Lesson 3 Slides\n    html-math-method: mathjax\n    highlight-style: arrow\nexecute:\n  echo: true\n  freeze: auto\n---\n\n\n\n\n# Back to research question\n\n\n## Case study: discrimination in developmental disability support (1.7.1)\n\n* __Previous research__\n  * Researchers examined DDS expenditures for developmentally disabled residents by ethnicity\n  * Found that the mean annual expenditures on Hispanics was less than that on White non-Hispanics. \n* __Result__: an allegation of ethnic discrimination was brought against the California DDS.\n* __Question: Are the data sufficient evidence of ethnic discrimination?__\n\n\n\n## Load `dds.discr` dataset from `oibiostat` package\n\n::: {style=\"font-size: 90%;\"}\n* The textbook's datasets are in the R package `oibiostat`\n* Make sure the `oibiostat` package is installed before running the code below.\n\n* Load the `oibiostat` package and the dataset `dds.discr`\n\n__[the code below needs to be run _every time_ you restart R or render a Qmd file]{style=\"color:darkorange\"}__\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(oibiostat)\ndata(\"dds.discr\")\n```\n:::\n\n\n* After loading the dataset `dds.discr` using `data(\"dds.discr\")`, you will see `dds.discr` in the Data list of the Environment window.\n:::\n\n\n## `glimpse()`\n\n::: {style=\"font-size: 80%;\"}\n__New: `glimpse()`__\n\n* Use `glimpse()` from the `tidyverse` package (technically it's from the `dplyr` package) to get information about variable types. \n* `glimpse()` tends to have nicer output for `tibbles` than `str()`\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nglimpse(dds.discr)  # from tidyverse package (dplyr)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 1,000\nColumns: 6\n$ id           <int> 10210, 10409, 10486, 10538, 10568, 10690, 10711, 10778, 1…\n$ age.cohort   <fct> 13-17, 22-50, 0-5, 18-21, 13-17, 13-17, 13-17, 13-17, 13-…\n$ age          <int> 17, 37, 3, 19, 13, 15, 13, 17, 14, 13, 13, 14, 15, 17, 20…\n$ gender       <fct> Female, Male, Male, Female, Male, Female, Female, Male, F…\n$ expenditures <int> 2113, 41924, 1454, 6400, 4412, 4566, 3915, 3873, 5021, 28…\n$ ethnicity    <fct> White not Hispanic, White not Hispanic, Hispanic, Hispani…\n```\n:::\n:::\n\n\n<!-- ![](/img_slides/dds.discr_glimpse.png){fig-align=\"center\"} -->\n\n\n## Recall previous data viz\n\n::: columns\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](03_Data_visualization_part_02_files/figure-revealjs/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n:::\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](03_Data_visualization_part_02_files/figure-revealjs/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n:::\n:::\n\n\n## Visualize in more detail: \n\nethnicity, age, and expenditures (code on next slide)\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](03_Data_visualization_part_02_files/figure-revealjs/unnamed-chunk-6-1.png){width=1152}\n:::\n:::\n\n\n\n## Code for Visualize in more detail: ethnicity, age, and expenditures\n\n::: {style=\"font-size: 80%;\"}\nPlot on previous slide\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"1-2,5,9\"}\ndds.discr_Hips_WhnH <- dds.discr %>%  \n  filter(ethnicity == \"White not Hispanic\" | ethnicity == \"Hispanic\" ) %>% \n  droplevels()   # remove empty factor levels\n\nggplot(data = dds.discr_Hips_WhnH,   \n       aes(x = expenditures,\n           y = age.cohort)) + \n  geom_boxplot(color=\"darkgrey\") + \n  facet_grid(rows = \"ethnicity\") +   \n  labs(x = \"Annual Expenditures ($)\",\n       y = \"Race and ethnicity\") +\n  geom_jitter(     \n    aes(color = ethnicity),      \n    alpha = 0.3,      \n    show.legend = FALSE,      \n    position = position_jitter(     \n      height = 0.4))      \n```\n:::\n\n\n\n## Mean annual DDS expenditures by race/ethnicity: default long format\n\n::: columns\n::: {.column width=\"45%\"}\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"3,5\"}\nmean_expend <- \n  dds.discr_Hips_WhnH %>% \n  group_by(\n    ethnicity, age.cohort)%>% \n  summarize(\n    ave = mean(expenditures))\n```\n:::\n\n:::\n\n::: {.column width=\"55%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nmean_expend\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 12 × 3\n# Groups:   ethnicity [2]\n   ethnicity          age.cohort    ave\n   <fct>              <fct>       <dbl>\n 1 Hispanic           0-5         1393.\n 2 Hispanic           6-12        2312.\n 3 Hispanic           13-17       3955.\n 4 Hispanic           18-21       9960.\n 5 Hispanic           22-50      40924.\n 6 Hispanic           51+        55585 \n 7 White not Hispanic 0-5         1367.\n 8 White not Hispanic 6-12        2052.\n 9 White not Hispanic 13-17       3904.\n10 White not Hispanic 18-21      10133.\n11 White not Hispanic 22-50      40188.\n12 White not Hispanic 51+        52670.\n```\n:::\n:::\n\n:::\n:::\n\n## Mean annual DDS expenditures by race/ethnicity: wide format\n\n::: columns\n::: {.column width=\"40%\"}\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"3-5\"}\nmean_expend_wide <- \n  mean_expend %>% \n  pivot_wider(\n    names_from = ethnicity,\n    values_from = ave)\n```\n:::\n\n:::\n\n::: {.column width=\"60%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nmean_expend_wide\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 3\n  age.cohort Hispanic `White not Hispanic`\n  <fct>         <dbl>                <dbl>\n1 0-5           1393.                1367.\n2 6-12          2312.                2052.\n3 13-17         3955.                3904.\n4 18-21         9960.               10133.\n5 22-50        40924.               40188.\n6 51+          55585                52670.\n```\n:::\n:::\n\n:::\n:::\n\n\n## Differences in mean annual DDS expenditures by age cohort and race/ethnicity\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"2\"}\nmean_expend_wide <- mean_expend_wide %>% \n  mutate(diff_mean = `White not Hispanic` - Hispanic)\n\nmean_expend_wide\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 4\n  age.cohort Hispanic `White not Hispanic` diff_mean\n  <fct>         <dbl>                <dbl>     <dbl>\n1 0-5           1393.                1367.     -26.3\n2 6-12          2312.                2052.    -260. \n3 13-17         3955.                3904.     -50.9\n4 18-21         9960.               10133.     173. \n5 22-50        40924.               40188.    -736. \n6 51+          55585                52670.   -2915. \n```\n:::\n:::\n\n\n::: {style=\"font-size: 80%;\"}\n__Question__: Are the data sufficient evidence of ethnic discrimination in DDS expenditures when comparing Hispanics with White non-Hispanics?\n:::\n\n## Simpson’s paradox\n\n::: {style=\"font-size: 80%;\"}\n* This case study is an example of __confounding__ known as Simpson’s paradox\n\n* __Simpson’s paradox__ happens when an association observed in several groups disappears or reverses direction when the groups are combined. \n\n* In other words, an association between two variables $X$ and $Y$ may disappear or reverse direction once data are partitioned into subpopulations based on a third variable $Z$ (i.e., a confounding variable).\n:::\n\n![](/img_slides/ddsConfounding.png){fig-align=\"center\"}\n\n# The tidyverse\n\n![[Artwork by @allison_horst](https://allisonhorst.com/)](/img_slides/tidyverse_celestial.png){fig-align=\"center\"}\n\n\n## Tools for wrangling data\n\n::: {style=\"font-size: 70%;\"}\n- `tidyverse` functions\n    + `tidyverse` is a [suite of packages](https://www.tidyverse.org/packages/) that implement `tidy` methods for data importing, cleaning, wrangling, and visualizing\n    + load the `tidyverse` packages by running the code `library(tidyverse)` \n        * Don't forget to first install `tidyverse`!\n\n- Functions to easily work with rows and columns, such as\n    + subset rows/columns\n    + add new rows/columns\n    + join together different data sets\n    + make data _long_ or _wide_\n\n- There are often many steps to tidy data\n    + we string together commands \n    + to be performed sequentially \n    + using pipes `%>%`\n:::\n\n\n## Summary of data wrangling so far\n\n::: {style=\"font-size: 80%;\"}\n* The pipe `%>%` to string together commands in sequence\n* `mutate()` to add a new variable to a dataset\n* `select()` to select columns (or deselect columns with -variable)\n* `filter()` to select specific rows\n* `pivot_wider()` to reshape a dataset from a long to a wide format\n\n__Summarizing data__\n\n* `tabyl()` from `janitor` package to make frequency tables of categorical variables\n* `summarize()` to get summary statistics of variables\n* `group_by()` to group data by categorical variables before finding summaries\n:::\n\n## What packages are included in the `tidyverse`? {.smaller}\n\n::: columns\n::: {.column width=\"35%\"}\n__Core packages__  \nThese automatically load when loading the tidyverse package\n\n![[https://www.tidyverse.org/](https://www.tidyverse.org/)](/img_slides/tidyverse_core.png){fig-align=\"center\"}\n:::\n\n::: {.column width=\"65%\"}\n\nList of all packages:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntidyverse_packages(include_self = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"broom\"         \"conflicted\"    \"cli\"           \"dbplyr\"       \n [5] \"dplyr\"         \"dtplyr\"        \"forcats\"       \"ggplot2\"      \n [9] \"googledrive\"   \"googlesheets4\" \"haven\"         \"hms\"          \n[13] \"httr\"          \"jsonlite\"      \"lubridate\"     \"magrittr\"     \n[17] \"modelr\"        \"pillar\"        \"purrr\"         \"ragg\"         \n[21] \"readr\"         \"readxl\"        \"reprex\"        \"rlang\"        \n[25] \"rstudioapi\"    \"rvest\"         \"stringr\"       \"tibble\"       \n[29] \"tidyr\"         \"xml2\"          \"tidyverse\"    \n```\n:::\n:::\n\n\n* Packages not a part of the core get installed with the tidyverse suite, but need to be loaded separately.  \n* See [https://www.tidyverse.org/packages/](https://www.tidyverse.org/packages/) for more info.\n\n:::\n:::\n\n",
    "supporting": [
      "03_Data_visualization_part_02_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}