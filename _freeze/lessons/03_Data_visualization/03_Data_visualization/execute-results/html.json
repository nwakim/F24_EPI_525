{
  "hash": "b868f95b7c1da71078900037f2685348",
  "result": {
    "markdown": "---\ntitle: \"Lesson 3: Data visualization\"\ndate: \"10/4/2023\"\ncategories: [\"Week 2\"]\nauthor: \"Meike Niederhausen and Nicky Wakim\"\ntitle-slide-attributes:\n    data-background-color: \"#3070BF\"\nformat: \n  revealjs:\n    theme: \"../simple_NW.scss\"\n    toc: true\n    toc-depth: 1\n    toc-title: Class Overview\n    chalkboard: true\n    slide-number: true\n    show-slide-number: all\n    width: 1600\n    height: 1100\n    footer: Lesson 3 Slides\n    html-math-method: mathjax\n    highlight-style: arrow\nexecute:\n  echo: true\n  freeze: auto\n---\n\n\n\n\n\n\n## Goals for today \n\n::: columns\n::: {.column width=\"50%\"}\n\n* __Exploratory Data Analysis (EDA)__ (Sections 1.4, 1.5, 1.6, 1.7.1)\n  * Data visualization with ggplot\n    * numerical & categorical variables, and relationships between variables\n  * Summarizing numerical data\n  * Frequency (two-way) tables\n\n* Some __data wrangling__ techniques along the way\n:::\n\n::: {.column width=\"50%\"}\n![[Artwork by @allison_horst](https://allisonhorst.com/)](../img_slides/horst_ggplot2_exploratory.png){fig-align=\"center\"}\n\n:::\n:::\n\n# R Packages\n\nA good analogy for R packages is that they   \nare like apps you can download onto a mobile phone:\n\n![](../img_slides/R_vs_R_packages.png){fig-align=\"center\"}\n\n[ModernDive Figure 1.4](https://moderndive.com/1-getting-started.html#packages)\n\n\n## From last time: Install the pacakges listed below\n::: {style=\"font-size: 50%;\"}\n* `knitr` \n  - this might actually already be installed\n  - check your packages list\n* `tidyverse` \n  - this is actually a bundle of packages\n  - *Warning: it will take a while to install!!!*\n  - see more info at [https://tidyverse.tidyverse.org/](https://tidyverse.tidyverse.org/) \n* `rstatix`\n  - for summary statistics of a dataset\n* `janitor`\n  - for cleaning and exploring data\n* `ggridges`\n  - for creating ridgeline plots\n* `devtools` \n  - used to create R packages\n  - for our purposes, needed to install some packages\n* `oi_biostat_data` \n  - this package is on github \n  - __see the next slide for directions on how to install `oi_biostat_data`__\n\n:::  \n\n\n## Directions for installing package `oibiostat` \n\n::: {style=\"font-size: 70%;\"}\n* The textbook's datasets are in the R package `oibiostat`\n* Explanation of code below\n  * Installation of `oibiostat` package requires first installing `devtools` package\n  * The code `devtools::install_github()` tells R to use the command `install_github()` from the `devtools` package without loading the entire package and all of its commands (which `library(devtools)` would do).\n:::\n  \n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"devtools\")\ndevtools::install_github(\"OI-Biostat/oi_biostat_data\", force = TRUE)\n```\n:::\n\n\n::: {style=\"font-size: 70%;\"}\n* After running the code above, put `#` in front of the commands so that RStudio doesn't evaluate them when rendering.\n* Now load the `oibiostat` package\n  * [the code below needs to be run _every time_ you restart R or render a Qmd file]{style=\"color:darkorange\"}\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(oibiostat)\n```\n:::\n\n\n\n\n## Load packages with `library()` command  \n\n::: {style=\"font-size: 90%;\"}\n- Tip: __at the top of your Qmd file,__ create a chunk that loads all of the R packages you want to use in that file. \n\n- Use the `library()` command to load each required package.\n  - Packages need to be reloaded *every* time you open Rstudio.\n  - `library()` commands to load needed packages *must* be in the Qmd file\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# run these every time you open Rstudio\nlibrary(tidyverse)    \nlibrary(oibiostat)\nlibrary(ggridges)\nlibrary(janitor)\nlibrary(rstatix)\nlibrary(knitr)\nlibrary(gtsummary) # NEW!!\n```\n:::\n\n\n::: {style=\"font-size: 90%;\"}\n- You can check whether a package has been loaded or not \n  - by looking at the Packages tab and \n  - seeing whether it has been checked off or not\n:::\n\n# Case study: discrimination in developmental disability support (Section 1.7.1)\n\n## Case Study Description \n\n::: {style=\"font-size: 65%;\"}\n* In the US, individuals with developmental disabilities typically receive services and support from state governments. \n  * California allocates funds to developmentally disabled residents through the _Department of Developmental Services (DDS)_\n  * Recipients of DDS funds are referred to as \"consumers.\" \n* Dataset `dds.discr` \n  * sample of 1,000 DDS consumers (out of a total of ~ 250,000)\n  * data include __[age, gender, race/ethnicity, and annual DDS financial support per consumer]{style=\"color:green\"}__\n* __Previous research__\n  * Researchers examined expenditures on consumers by ethnicity\n  * Found that the mean annual expenditure on Hispanics was less than that on White non-Hispanics. \n* Result: an allegation of ethnic discrimination was brought against the California DDS.\n* __Question: Are the data sufficient evidence of ethnic discrimination?__\n\n* See Section 1.7.1 in the textbook for more details\n:::\n\n\n## Load `dds.discr` dataset from `oibiostat` package\n\n::: {style=\"font-size: 90%;\"}\n* The textbook's datasets are in the R package `oibiostat`\n* Make sure the `oibiostat` package is installed before running the code below.\n\n* Load the `oibiostat` package and the dataset `dds.discr`\n\n__[the code below needs to be run _every time_ you restart R or render a Qmd file]{style=\"color:darkorange\"}__\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(oibiostat)\ndata(\"dds.discr\")\n```\n:::\n\n\n* After loading the dataset `dds.discr` using `data(\"dds.discr\")`, you will see `dds.discr` in the Data list of the Environment window.\n:::\n\n\n## Getting to know the dataset\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndim(dds.discr)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 1000    6\n```\n:::\n\n```{.r .cell-code}\nnames(dds.discr)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"id\"           \"age.cohort\"   \"age\"          \"gender\"       \"expenditures\"\n[6] \"ethnicity\"   \n```\n:::\n\n```{.r .cell-code}\nlength(unique(dds.discr$id)) # How many unique id's are there?\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 1000\n```\n:::\n:::\n\n\n\n## `str()` structure\n\n::: {style=\"font-size: 80%;\"}\n* We previously used the base R structure command `str()` to get information about variable types in a dataset. \n* Note this dataset is a `tibble` instead of a `data.frame`\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(dds.discr)      # base R\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ntibble [1,000 × 6] (S3: tbl_df/tbl/data.frame)\n $ id          : int [1:1000] 10210 10409 10486 10538 10568 10690 10711 10778 10820 10823 ...\n $ age.cohort  : Factor w/ 6 levels \"0-5\",\"6-12\",\"13-17\",..: 3 5 1 4 3 3 3 3 3 3 ...\n $ age         : int [1:1000] 17 37 3 19 13 15 13 17 14 13 ...\n $ gender      : Factor w/ 2 levels \"Female\",\"Male\": 1 2 2 1 2 1 1 2 1 2 ...\n $ expenditures: int [1:1000] 2113 41924 1454 6400 4412 4566 3915 3873 5021 2887 ...\n $ ethnicity   : Factor w/ 8 levels \"American Indian\",..: 8 8 4 4 8 4 8 3 8 4 ...\n - attr(*, \"spec\")=\n  .. cols(\n  ..   ID = col_integer(),\n  ..   `Age Cohort` = col_character(),\n  ..   Age = col_integer(),\n  ..   Gender = col_character(),\n  ..   Expenditures = col_integer(),\n  ..   Ethnicity = col_character()\n  .. )\n```\n:::\n:::\n\n\n<!-- ![](../img_slides/dds.discr_str.png){fig-align=\"center\"} -->\n\n\n## `glimpse()`\n\n::: {style=\"font-size: 80%;\"}\n__New: `glimpse()`__\n\n* Use `glimpse()` from the `tidyverse` package (technically it's from the `dplyr` package) to get information about variable types. \n* `glimpse()` tends to have nicer output for `tibbles` than `str()`\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nglimpse(dds.discr)  # from tidyverse package (dplyr)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 1,000\nColumns: 6\n$ id           <int> 10210, 10409, 10486, 10538, 10568, 10690, 10711, 10778, 1…\n$ age.cohort   <fct> 13-17, 22-50, 0-5, 18-21, 13-17, 13-17, 13-17, 13-17, 13-…\n$ age          <int> 17, 37, 3, 19, 13, 15, 13, 17, 14, 13, 13, 14, 15, 17, 20…\n$ gender       <fct> Female, Male, Male, Female, Male, Female, Female, Male, F…\n$ expenditures <int> 2113, 41924, 1454, 6400, 4412, 4566, 3915, 3873, 5021, 28…\n$ ethnicity    <fct> White not Hispanic, White not Hispanic, Hispanic, Hispani…\n```\n:::\n:::\n\n\n<!-- ![](../img_slides/dds.discr_glimpse.png){fig-align=\"center\"} -->\n\n\n## `summary()`\n\n::: {style=\"font-size: 80%;\"}\n* We previously used the base R structure command `summary()` to get summary information about variables\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(dds.discr)      # base R\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       id        age.cohort       age          gender     expenditures  \n Min.   :10210   0-5  : 82   Min.   : 0.0   Female:503   Min.   :  222  \n 1st Qu.:31809   6-12 :175   1st Qu.:12.0   Male  :497   1st Qu.: 2899  \n Median :55384   13-17:212   Median :18.0                Median : 7026  \n Mean   :54663   18-21:199   Mean   :22.8                Mean   :18066  \n 3rd Qu.:76135   22-50:226   3rd Qu.:26.0                3rd Qu.:37713  \n Max.   :99898   51+  :106   Max.   :95.0                Max.   :75098  \n                                                                        \n              ethnicity  \n White not Hispanic:401  \n Hispanic          :376  \n Asian             :129  \n Black             : 59  \n Multi Race        : 26  \n American Indian   :  4  \n (Other)           :  5  \n```\n:::\n:::\n\n\n\n## `tbl_summary()`: summary table\n\n::: columns\n::: {.column width=\"50%\"}\n::: {style=\"font-size: 80%;\"}\n* __New:__ Use `tbl_summary()` from the `gtsummary` package to get summary information\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# library(gtsummary)\ntbl_summary(dds.discr)\n```\n:::\n\n:::\n\n::: {.column width=\"50%\"}\n![](../img_slides/dds.discr_gtsummary.jpg){fig-align=\"center\" height=\"650\"}\n:::\n:::\n\n\n# Visualize numerical variables with `ggplot`\n\n::: columns\n::: {.column width=\"40%\"}\n![[ggplot](https://ggplot2.tidyverse.org/index.html)](../img_slides/ggplotlogo.png){fig-align=\"center\" height=\"400\"}\n:::\n\n::: {.column width=\"60%\"}\n![[Artwork by @allison_horst](https://allisonhorst.com/)](../img_slides/ggplot2_masterpiece.png){fig-align=\"center\" height=\"400\"}\n:::\n:::\n\n## What data (variables) are included in the plot below?\n\n![](../img_slides/ggplot_basics_from_ppt_figure_only.png){fig-align=\"center\"}\n\n## Basics of a ggplot\n\n![](../img_slides/ggplot_basics_from_ppt.png){fig-align=\"center\"}\n\n\n## Grammar of ggplot2\n\n![[Kieran Healy](https://github.com/rstudio-conf-2020/dataviz)](../img_slides/khealy_ggplot1.png){fig-align=\"center\"}\n\n\n## Histograms\n\nWhat is being measured on the vertical axes?\n\n::: columns\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = dds.discr, \n       aes(x = age)) +\n  geom_histogram() \n```\n\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/unnamed-chunk-11-1.png){width=960}\n:::\n:::\n\n:::\n::: {.column width=\"50%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = dds.discr, \n       aes(x = expenditures)) +\n  geom_histogram() \n```\n\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/unnamed-chunk-12-1.png){width=960}\n:::\n:::\n\n:::\n:::\n\n\n## Histograms showing proportions\n\n::: columns\n::: {.column width=\"50%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"4\"}\nggplot(data = dds.discr, \n       aes(x = age)) +\n  geom_histogram(\n    aes(y = stat(density)))  \n```\n\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/unnamed-chunk-13-1.png){width=960}\n:::\n:::\n\n:::\n::: {.column width=\"50%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"4-6\"}\nggplot(data = dds.discr, \n       aes(x = age)) +\n  geom_histogram(\n    aes(y = stat(density))) +  \n  scale_y_continuous(labels =   \n      scales::percent_format())  \n```\n\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/unnamed-chunk-14-1.png){width=960}\n:::\n:::\n\n:::\n:::\n\n\n## Distribution shapes\n\n![](../img_slides/distribution_shapes.png){fig-align=\"center\"}\n\n## Density plots\nWhat is being measured on the vertical axes?\n\n::: columns\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"3\"}\nggplot(data = dds.discr, \n       aes(x = age)) +\n  geom_density() \n```\n\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/unnamed-chunk-15-1.png){width=960}\n:::\n:::\n\n:::\n::: {.column width=\"50%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"3\"}\nggplot(data = dds.discr, \n       aes(x = age)) +\n  geom_histogram() \n```\n\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/unnamed-chunk-16-1.png){width=960}\n:::\n:::\n\n:::\n:::\n\n\n\n## Dot plots \n::: {style=\"font-size: 80%;\"}\n* Better for smaller samples\n* What is being measured on the vertical axes?\n:::\n\n::: columns\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"3\"}\nggplot(data = dds.discr, \n       aes(x = age)) +\n  geom_dotplot(binwidth =1) \n```\n\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/unnamed-chunk-17-1.png){width=960}\n:::\n:::\n\n:::\n::: {.column width=\"50%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"3\"}\nggplot(data = dds.discr, \n       aes(x = age)) +\n  geom_histogram(binwidth =1) \n```\n\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/unnamed-chunk-18-1.png){width=960}\n:::\n:::\n\n:::\n:::\n\n\n## Boxplots\n\n::: columns\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"2-3\"}\nggplot(data = dds.discr, \n       aes(x = age)) + \n  geom_boxplot() \n```\n\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/unnamed-chunk-19-1.png){width=480}\n:::\n:::\n\n:::\n::: {.column width=\"50%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"2-3\"}\nggplot(data = dds.discr, \n       aes(y = age)) + \n  geom_boxplot() \n```\n\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/unnamed-chunk-20-1.png){width=480}\n:::\n:::\n\n:::\n:::\n\n\n## Boxplots: 5 number summary visualization \n\n<!-- ![](../img_slides/boxplot_no_outliers.png) -->\nNo outliers:  ![[https://www.simplypsychology.org/boxplots.html](https://www.simplypsychology.org/boxplots.html)](../img_slides/boxplot_no_outliers.png){fig-align=\"center\" height=\"280\"}\n\nWith  outliers: ![[https://towardsdatascience.com/understanding-boxplots-5e2df7bcbd51](https://towardsdatascience.com/understanding-boxplots-5e2df7bcbd51)](../img_slides/boxplot_w_outliers.png){fig-align=\"center\" height=\"300\"}\n\n\n# Visualizing relationships between numerical and categorical variables (1.6.3)\n\n## Side-by-side boxplots \n\n::: columns\n::: {.column width=\"53%\"}\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"3-6\"}\nggplot(data = dds.discr, \n       aes(x = expenditures,\n           y = ethnicity)) + \n  geom_boxplot() + \n  labs(x = \"Annual Expenditures ($)\", \n       y = \"Race and ethnicity\")  \n```\n:::\n\n\n::: {style=\"font-size: 80%;\"}\nCan you determine the following using boxplots?\n\n* distribution shape\n* sample size\n:::\n:::\n\n::: {.column width=\"47%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/box_sbs_out-1.png){width=672}\n:::\n:::\n\n:::\n:::\n\n\n## Side-by-side boxplots with data points\n\n::: columns\n::: {.column width=\"53%\"}\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"4,7-12\"}\nggplot(data = dds.discr, \n       aes(x = expenditures,\n           y = ethnicity)) + \n  geom_boxplot(color=\"darkgrey\") + \n  labs(x = \"Annual Expenditures ($)\",\n       y = \"Race and ethnicity\") +\n  geom_jitter(     \n    aes(color = ethnicity),      \n    alpha = 0.3,      \n    show.legend = FALSE,      \n    position = position_jitter(     \n      height = 0.4))      \n```\n:::\n\n\n::: {style=\"font-size: 80%;\"}\nCan you determine the following using boxplots?\n\n* distribution shape\n* sample size\n:::\n\n:::\n::: {.column width=\"47%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/box_sbs_jitter_out-1.png){width=672}\n:::\n:::\n\n:::\n:::\n\n\n## Density plots by group\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"3\"}\nggplot(data = dds.discr, \n       aes(x = expenditures,\n           color = ethnicity)) + \n  geom_density() + \n  labs(x = \"Annual Expenditures ($)\")  \n```\n\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/unnamed-chunk-25-1.png){width=960}\n:::\n:::\n\n\n\n## Ridgeline plot \n\n::: columns\n::: {.column width=\"53%\"}\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"4-5,7-9,12-14\"}\n# library(ggridges)\nggplot(data = dds.discr,\n       aes(x = expenditures,\n           y = ethnicity,      \n           fill = ethnicity)      \n       ) + \n  geom_density_ridges(      \n    alpha = 0.3,      \n    show.legend = FALSE) +      \n  labs(x = \"Annual Expenditures ($)\",\n       y = \"Race and ethnicity\",\n       title =        \n\"Expenditures by race and \n       \\nethnicity\")       \n```\n:::\n\n:::\n::: {.column width=\"47%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/density_ridge_out-1.png){width=672}\n:::\n:::\n\n:::\n:::\n\n\n## Transforming data (1.4.5)\n\n::: {style=\"font-size: 80%;\"}\n* We sometimes apply a transformation to highly skewed data to make it more symmetric\n* Log transformations are often used for skewed right data\n:::\n\n::: columns\n::: {.column width=\"50%\"}\n`x = expenditures`\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"2\"}\nggplot(data = dds.discr, \n       aes(x = expenditures)) +  \n  geom_density() \n```\n\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/unnamed-chunk-28-1.png){width=960}\n:::\n:::\n\n:::\n\n::: {.column width=\"50%\"}\n`x = log(expenditures)`\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"2\"}\nggplot(data = dds.discr, \n       aes(x = log(expenditures))) +  \n  geom_density() \n```\n\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/unnamed-chunk-29-1.png){width=960}\n:::\n:::\n\n\n:::\n:::\n\n\n# Relationships between two numerical variables (1.6.1)\n\n## Scatterplots\n\n::: columns\n::: {.column width=\"55%\"}\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"4\"}\nggplot(data = dds.discr, \n       aes(x = age,\n           y = expenditures)) + \n  geom_point() +       \n  labs(x = \"Age\",\n       y = \"Annual Expenditures ($)\") \n```\n:::\n\n\n::: {style=\"font-size: 80%;\"}\nResponse vs. explanatory variables (Section 1.2.3)\n\n- A **response variable** measures the outcome of interest in a study\n- A study will typically examine whether the values of a response variable differ as values of an **explanatory variable** change\n\n:::\n\n:::\n::: {.column width=\"45%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/scatter_out-1.png){width=576}\n:::\n:::\n\n:::\n:::\n\n::: {style=\"font-size: 80%;\"}\nDescribe the association between the variables\n:::\n\n## Describing associations between 2 numerical variables\n\n::: columns\n::: {.column width=\"50%\"}\n\n::: {style=\"font-size: 80%;\"}\nTwo variables $x$ and $y$ are \n\n- **positively associated** if $y$ increases as $x$ increases. \n\n- **negatively associated** if $y$ decreases as $x$ increases.\n\n- If there is no association between the variables, then we say they are **uncorrelated** or **independent**.\n\n:::\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/scatter_out2-1.png){width=576}\n:::\n:::\n\n:::\n:::\n\n::: {style=\"font-size: 80%;\"}\n* The term \"association\" is a very general term.\n  * Can be used for numerical or categorical variables\n  * Not specifically referring to linear associations\n:::\n\n\n## (Pearson) Correlation coefficient $r$\n\n::: {style=\"font-size: 70%;\"}\n* $r = -1$ indicates a __perfect negative linear relationship__: As one variable increases, the value of the other variable tends to go down, following a *straight line*.\n* $r = 0$ indicates __no linear relationship__: The values of both variables go up/down independently of each other.\n* $r = 1$ indicates a __perfect positive linear relationship__: As the value of one variable goes up, the value of the other variable tends to go up as well in a linear fashion.\n\n* The closer $r$ is to ±1, the stronger the linear association.\n:::\n\n![](../img_slides/MD_correlation1-1.png){fig-align=\"center\"}\n\n\n\n## (Pearson) Correlation coefficient (r): formula\n\n::: {style=\"font-size: 80%;\"}\nThe (Peasron) correlation coefficient of variables $x$ and $y$ can be computed using the formula\n$$r = \\frac{1}{n-1}\\sum_{i=1}^{n}\\Big(\\frac{x_i - \\bar{x}}{s_x}\\Big)\\Big(\\frac{y_i - \\bar{y}}{s_y}\\Big)$$\nwhere \n\n* $(x_1,y_1),(x_2,y_2),...,(x_n,y_n)$ are the $n$ paired values of the variables $x$ and $y$ \n* $s_x$ and $s_y$ are the sample standard deviations of the variables $x$ and $y$, respectively\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncor(dds.discr$age, dds.discr$expenditures)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.8432422\n```\n:::\n:::\n\n\n\n\n\n## Guess the correlation game!\n\n::: {style=\"font-size: 80%;\"}\n::: columns\n::: {.column width=\"50%\"}\nRossman & Chance's applet\n\n![](../img_slides/screenshot_guess_corr_iscam.png){fig-align=\"center\"}\n\nTracks performance of guess vs. actual, error vs. actual, and error vs. trial\n\n[http://www.rossmanchance.com/applets/GuessCorrelation.html](http://www.rossmanchance.com/applets/GuessCorrelation.html)\n:::\n\n::: {.column width=\"50%\"}\n\n\nOr, for the Atari-like experience\n\n\n![[http://guessthecorrelation.com/](http://guessthecorrelation.com/)](../img_slides/screenshot_guess_corr_atari.png){fig-align=\"center\"}\n\n:::\n:::\n\n:::\n\n\n## Scatterplots with color-coded dots \n\nDescribe the association between the variables\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"4-5,8\"}\nggplot(data = dds.discr, \n       aes(x = age, y = expenditures,\n           color = ethnicity)) +   \n  geom_point(alpha = .5) +       \n  labs(x = \"Age\", y = \"Annual Expenditures ($)\") +\n  theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/unnamed-chunk-34-1.png){width=1152}\n:::\n:::\n\n\n\n# Categorical data (1.5) and Relationships between two categorical variables (1.6.2)\n\n## Barplots\n\n::: columns\n::: {.column width=\"50%\"}\n::: {style=\"font-size: 80%;\"}\nCounts (below) vs.  \npercentages (right)\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"3\"}\nggplot(data = dds.discr, \n       aes(x = ethnicity)) +\n  geom_bar() \n```\n\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/unnamed-chunk-35-1.png){width=576}\n:::\n:::\n\n:::\n\n::: {.column width=\"50%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"3-6\"}\nggplot(data = dds.discr, \n       aes(x = ethnicity)) +\n  geom_bar(aes(y = stat(prop),  \n               group = 1)) + \n  scale_y_continuous(labels =  \n      scales::percent_format())  \n```\n\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/unnamed-chunk-36-1.png){width=576}\n:::\n:::\n\n:::\n:::\n\n\n## Barplots with 2 variables: segmented bar plots\n\n::: columns\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"3\"}\nggplot(data = dds.discr, \n       aes(x = ethnicity,\n           fill = age.cohort)) + \n  geom_bar() \n```\n\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/unnamed-chunk-37-1.png){width=576}\n:::\n:::\n\n:::\n::: {.column width=\"50%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"3-4\"}\nggplot(data = dds.discr, \n       aes(x = ethnicity,\n           fill = age.cohort)) + \n  geom_bar(position = \"fill\")  \n```\n\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/unnamed-chunk-38-1.png){width=576}\n:::\n:::\n\n:::\n:::\n\n\n## Barplots with 2 variables: side-by-side bar plots\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"3-4\"}\nggplot(data = dds.discr, \n       aes(x = ethnicity,\n           fill = age.cohort)) + \n  geom_bar(position = \"dodge\") \n```\n\n::: {.cell-output-display}\n![](03_Data_visualization_files/figure-revealjs/unnamed-chunk-39-1.png){width=1152}\n:::\n:::\n\n\n\n# Summarizing categorical data and some data wrangling\n\n<!-- ::: {layout-ncol=3} -->\n::: columns\n::: {.column width=\"33%\"}\n![[dplyr](https://dplyr.tidyverse.org/)](../img_slides/hex-dplyr.png){fig-align=\"center\" height=\"300\"}\n:::\n::: {.column width=\"33%\"}\n![[magrittr](https://magrittr.tidyverse.org/)](../img_slides/magrittr.png){fig-align=\"center\" height=\"300\"}\n:::\n::: {.column width=\"33%\"}\n![[janitor](https://cran.r-project.org/web/packages/janitor/readme/README.html)](../img_slides/janitor_logo_small.png){fig-align=\"center\" height=\"300\"}\n:::\n:::\n\n## Frequency tables: `count()`\n\n::: columns\n::: {.column width=\"50%\"}\n::: {style=\"font-size: 80%;\"}\n* `count` is from the `dplyr` package\n* the output is a long tibble, and not a \"nice\" table\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndds.discr %>% count(ethnicity)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 8 × 2\n  ethnicity              n\n  <fct>              <int>\n1 American Indian        4\n2 Asian                129\n3 Black                 59\n4 Hispanic             376\n5 Multi Race            26\n6 Native Hawaiian        3\n7 Other                  2\n8 White not Hispanic   401\n```\n:::\n:::\n\n:::\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\ndds.discr %>% \n  count(ethnicity, age.cohort)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 35 × 3\n   ethnicity       age.cohort     n\n   <fct>           <fct>      <int>\n 1 American Indian 13-17          1\n 2 American Indian 22-50          1\n 3 American Indian 51+            2\n 4 Asian           0-5            8\n 5 Asian           6-12          18\n 6 Asian           13-17         20\n 7 Asian           18-21         41\n 8 Asian           22-50         29\n 9 Asian           51+           13\n10 Black           0-5            3\n# ℹ 25 more rows\n```\n:::\n:::\n\n:::\n:::\n\n## How to use the pipe `%>%`\n\n::: {style=\"font-size: 80%;\"}\nThe pipe operator `%>%` strings together commands to be performed sequentially\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndds.discr %>% head(n=3)      # pronounce %>% as \"then\"\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 6\n     id age.cohort   age gender expenditures ethnicity         \n  <int> <fct>      <int> <fct>         <int> <fct>             \n1 10210 13-17         17 Female         2113 White not Hispanic\n2 10409 22-50         37 Male          41924 White not Hispanic\n3 10486 0-5            3 Male           1454 Hispanic          \n```\n:::\n:::\n\n\n::: {style=\"font-size: 80%;\"}\n- Always _first list the tibble_ that the commands are being applied to\n- Can use __multiple pipes__ to run multiple commands in sequence\n    + What does the following code do?\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndds.discr %>% head(n=3) %>% summary()\n```\n:::\n\n\n## Frequency tables: `janitor` package's `tabyl` function \n\n::: columns\n::: {.column width=\"50%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"3\"}\n# default table\ndds.discr %>% \n  tabyl(ethnicity)  \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          ethnicity   n percent\n    American Indian   4   0.004\n              Asian 129   0.129\n              Black  59   0.059\n           Hispanic 376   0.376\n         Multi Race  26   0.026\n    Native Hawaiian   3   0.003\n              Other   2   0.002\n White not Hispanic 401   0.401\n```\n:::\n:::\n\n\n:::\n::: {.column width=\"50%\"}\n\n`adorn_` your table!\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"3-4\"}\ndds.discr %>% \n  tabyl(ethnicity) %>%\n  adorn_totals(\"row\") %>% \n  adorn_pct_formatting(digits=2)  \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          ethnicity    n percent\n    American Indian    4   0.40%\n              Asian  129  12.90%\n              Black   59   5.90%\n           Hispanic  376  37.60%\n         Multi Race   26   2.60%\n    Native Hawaiian    3   0.30%\n              Other    2   0.20%\n White not Hispanic  401  40.10%\n              Total 1000 100.00%\n```\n:::\n:::\n\n\n:::\n:::\n\n\n## Relative frequency table\n\n::: columns\n::: {.column width=\"40%\"}\n\n::: {style=\"font-size: 80%;\"}\n* A __relative frequency__ table shows __proportions (or percentages)__ instead of counts\n\n* To the right I removed (deselected) the counts column (`n`) to create a relative frequency table \n:::\n:::\n\n::: {.column width=\"60%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"4-5\"}\ndds.discr %>% \n  tabyl(ethnicity) %>%\n  adorn_totals(\"row\") %>% \n  adorn_pct_formatting(digits=2) %>%   \n  select(-n) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          ethnicity percent\n    American Indian   0.40%\n              Asian  12.90%\n              Black   5.90%\n           Hispanic  37.60%\n         Multi Race   2.60%\n    Native Hawaiian   0.30%\n              Other   0.20%\n White not Hispanic  40.10%\n              Total 100.00%\n```\n:::\n:::\n\n\n:::\n:::\n\n\n\n## Contingency tables (two-way tables)\n\n::: columns\n::: {.column width=\"40%\"}\n::: {style=\"font-size: 80%;\"}\n* **Contingency tables** summarize data for two categorical variables\n  * with each value in the table representing the number of times  \n  a particular combination of outcomes occurs\n\n* **Row & column totals**   \nare sometimes called **marginal totals** \n:::\n\n:::\n::: {.column width=\"60%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"2-3\"}\ndds.discr %>% \n  tabyl(ethnicity, gender) %>%    \n  adorn_totals(c(\"row\", \"col\"))    \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          ethnicity Female Male Total\n    American Indian      3    1     4\n              Asian     61   68   129\n              Black     26   33    59\n           Hispanic    192  184   376\n         Multi Race     13   13    26\n    Native Hawaiian      2    1     3\n              Other      1    1     2\n White not Hispanic    205  196   401\n              Total    503  497  1000\n```\n:::\n:::\n\n\n:::\n:::\n\n## Contingency tables with percentages\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"4-6\"}\ndds.discr %>% \n  tabyl(ethnicity, age.cohort) %>%\n  adorn_totals(c(\"row\")) %>%\n  adorn_percentages(\"row\") %>%   \n  adorn_pct_formatting(digits=0) %>%    \n  adorn_ns()    \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          ethnicity      0-5      6-12      13-17     18-21     22-50       51+\n    American Indian  0%  (0)  0%   (0)  25%   (1)  0%   (0) 25%   (1) 50%   (2)\n              Asian  6%  (8) 14%  (18)  16%  (20) 32%  (41) 22%  (29) 10%  (13)\n              Black  5%  (3) 19%  (11)  20%  (12) 15%   (9) 29%  (17) 12%   (7)\n           Hispanic 12% (44) 24%  (91)  27% (103) 21%  (78) 11%  (43)  5%  (17)\n         Multi Race 27%  (7) 35%   (9)  27%   (7)  8%   (2)  4%   (1)  0%   (0)\n    Native Hawaiian  0%  (0)  0%   (0)   0%   (0)  0%   (0) 67%   (2) 33%   (1)\n              Other  0%  (0)  0%   (0) 100%   (2)  0%   (0)  0%   (0)  0%   (0)\n White not Hispanic  5% (20) 11%  (46)  17%  (67) 17%  (69) 33% (133) 16%  (66)\n              Total  8% (82) 18% (175)  21% (212) 20% (199) 23% (226) 11% (106)\n```\n:::\n:::\n\n\n\n# Summarizing numeric data\n\n\n## Mean annual DDS expenditures by race/ethnicity\n\n::: columns\n::: {.column width=\"45%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nmean(dds.discr$expenditures)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 18065.79\n```\n:::\n\n```{.r .cell-code}\ndds.discr %>% \n  summarize(\n    ave = mean(expenditures),\n    SD = sd(expenditures),\n    med = median(expenditures))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 3\n     ave     SD   med\n   <dbl>  <dbl> <dbl>\n1 18066. 19543.  7026\n```\n:::\n:::\n\n:::\n\n::: {.column width=\"55%\"}\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"2\"}\ndds.discr %>% \n  group_by(ethnicity) %>% \n  summarize(\n    ave = mean(expenditures),\n    SD = sd(expenditures),\n    med = median(expenditures))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 8 × 4\n  ethnicity             ave     SD    med\n  <fct>               <dbl>  <dbl>  <dbl>\n1 American Indian    36438. 25694. 41818.\n2 Asian              18392. 19209.  9369 \n3 Black              20885. 20549.  8687 \n4 Hispanic           11066. 15630.  3952 \n5 Multi Race          4457.  7332.  2622 \n6 Native Hawaiian    42782.  6576. 40727 \n7 Other               3316.  1836.  3316.\n8 White not Hispanic 24698. 20604. 15718 \n```\n:::\n:::\n\n\n:::\n:::\n\n## `get_summary_stats()` from `rstatix` package\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndds.discr %>% get_summary_stats()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 13\n  variable         n   min   max median     q1     q3   iqr    mad   mean     sd\n  <fct>        <dbl> <dbl> <dbl>  <dbl>  <dbl>  <dbl> <dbl>  <dbl>  <dbl>  <dbl>\n1 id            1000 10210 99898 55384. 31809. 76135. 44326 3.27e4 5.47e4 2.56e4\n2 age           1000     0    95    18     12     26     14 1.04e1 2.28e1 1.85e1\n3 expenditures  1000   222 75098  7026   2899. 37713. 34814 7.76e3 1.81e4 1.95e4\n# ℹ 2 more variables: se <dbl>, ci <dbl>\n```\n:::\n\n```{.r .cell-code}\ndds.discr %>% \n  group_by(ethnicity) %>%\n  get_summary_stats(expenditures, type = \"common\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 8 × 11\n  ethnicity variable     n   min   max median    iqr   mean     sd     se     ci\n  <fct>     <fct>    <dbl> <dbl> <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>\n1 American… expendi…     4  3726 58392 41818. 34085. 36438. 25694. 12847. 40885.\n2 Asian     expendi…   129   374 75098  9369  30892  18392. 19209.  1691.  3346.\n3 Black     expendi…    59   240 60808  8687  37987  20885. 20549.  2675.  5355.\n4 Hispanic  expendi…   376   222 65581  3952   7961. 11066. 15630.   806.  1585.\n5 Multi Ra… expendi…    26   669 38619  2622   2060.  4457.  7332.  1438.  2962.\n6 Native H… expendi…     3 37479 50141 40727   6331  42782.  6576.  3797. 16337.\n7 Other     expendi…     2  2018  4615  3316.  1298.  3316.  1836.  1298. 16499.\n8 White no… expendi…   401   340 68890 15718  39157  24698. 20604.  1029.  2023.\n```\n:::\n:::\n\n\n## How to force all output to be shown? (1/2) \n\nUse `kable()` from the `knitr` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndds.discr %>% get_summary_stats() %>% kable()\n```\n\n::: {.cell-output-display}\n|variable     |    n|   min|   max|  median|       q1|       q3|   iqr|       mad|     mean|        sd|      se|       ci|\n|:------------|----:|-----:|-----:|-------:|--------:|--------:|-----:|---------:|--------:|---------:|-------:|--------:|\n|id           | 1000| 10210| 99898| 55384.5| 31808.75| 76134.75| 44326| 32734.325| 54662.85| 25643.673| 810.924| 1591.310|\n|age          | 1000|     0|    95|    18.0|    12.00|    26.00|    14|    10.378|    22.80|    18.462|   0.584|    1.146|\n|expenditures | 1000|   222| 75098|  7026.0|  2898.75| 37712.75| 34814|  7760.670| 18065.79| 19542.831| 617.999| 1212.724|\n:::\n:::\n\n\n## How to force all output to be shown? `knitr` (2/2) \n\nUse `kable()` from the `knitr` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndds.discr %>% \n  group_by(ethnicity) %>%\n  get_summary_stats(expenditures, type = \"common\") %>% \n  kable()\n```\n\n::: {.cell-output-display}\n|ethnicity          |variable     |   n|   min|   max|  median|      iqr|      mean|        sd|        se|        ci|\n|:------------------|:------------|---:|-----:|-----:|-------:|--------:|---------:|---------:|---------:|---------:|\n|American Indian    |expenditures |   4|  3726| 58392| 41817.5| 34085.25| 36438.250| 25693.912| 12846.956| 40884.748|\n|Asian              |expenditures | 129|   374| 75098|  9369.0| 30892.00| 18392.372| 19209.225|  1691.278|  3346.482|\n|Black              |expenditures |  59|   240| 60808|  8687.0| 37987.00| 20884.593| 20549.274|  2675.288|  5355.170|\n|Hispanic           |expenditures | 376|   222| 65581|  3952.0|  7961.25| 11065.569| 15629.847|   806.048|  1584.940|\n|Multi Race         |expenditures |  26|   669| 38619|  2622.0|  2059.75|  4456.731|  7332.135|  1437.950|  2961.514|\n|Native Hawaiian    |expenditures |   3| 37479| 50141| 40727.0|  6331.00| 42782.333|  6576.462|  3796.922| 16336.838|\n|Other              |expenditures |   2|  2018|  4615|  3316.5|  1298.50|  3316.500|  1836.356|  1298.500| 16499.007|\n|White not Hispanic |expenditures | 401|   340| 68890| 15718.0| 39157.00| 24697.549| 20604.376|  1028.933|  2022.793|\n:::\n:::\n\n\n\n\n# Back to research question\n\n\n## Case study: discrimination in developmental disability support (1.7.1)\n\n* __Previous research__\n  * Researchers examined DDS expenditures for developmentally disabled residents by ethnicity\n  * Found that the mean annual expenditures on Hispanics was less than that on White non-Hispanics. \n* __Result__: an allegation of ethnic discrimination was brought against the California DDS.\n* __Question: Are the data sufficient evidence of ethnic discrimination?__\n\n\n",
    "supporting": [
      "03_Data_visualization_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}