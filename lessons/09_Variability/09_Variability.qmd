---
title: "Lesson 9: Variability in estimates"
subtitle: "TB sections 4.1"
author: "Meike Niederhausen and Nicky Wakim"
title-slide-attributes:
    data-background-color: "#3070BF"
date: "10/30/2024"
format: 
  revealjs:
    theme: "../simple_NW.scss"
    chalkboard: true
    slide-number: true
    show-slide-number: all
    width: 1955
    height: 1100
    footer: Lesson 9 Slides
    html-math-method: mathjax
    highlight-style: arrow
execute:
  echo: true
  freeze: true
---


```{r}
#| label: "setup" 
#| include: false
#| message: false
#| warning: false

library(tidyverse)
library(janitor)
library(rstatix)
library(oibiostat) 
library(knitr)
library(moderndive) # NEW!!
library(ggplot2)
library(dplyr)

# terminal: for icons
# quarto install extension quarto-ext/fontawesome

# set ggplot theme for slides 
theme_set(theme_bw(base_size = 22))
# theme_update(text = element_text(size=16))  # set global text size for ggplots

set.seed(456)
```

## 

![[Artwork by @allison_horst](https://allisonhorst.com/)](../img_slides/horst_samples.png){fig-align="center"}

```{css, echo=FALSE}
.reveal code {
  max-height: 100% !important;
}
```

# Learning Objectives
2. Illustrate how information from several samples are connected to the population and to the sampling distribution

4. Distinguish different language referring to different variabilities (population, sample, sampling distribution)

3. Apply the Central Limit Theorem to approximate the sampling distribution

## Where are we?

![](../img_slides/course_map.png){fig-align="center"}


## From Lesson 1: Population vs. sample

::: columns
::: column

::: red
::: red-ttl
(Target) Population
:::
::: red-cont
* Group of interest being studied
* Group from which the sample is selected
  - Studies often have _inclusion_ and/or _exclusion_ criteria
* Almost always too expensive or logistically impossible to collect data for every case in a population
  
:::
:::
:::

::: column
::: pink
::: pink-ttl
Sample
::: 
::: pink-cont
* Group on which data are collected
* Often a **small subset** of the population
* Easier to collect data on 
* If we do it right, we might be able to answer our question about the target population
:::
:::

:::
:::

- Goal is to get a __representative__ sample of the population: the characteristics of the sample are similar to the characteristics of the population
    
## Why sample statistics?

- When we want to estimate features of the population

  - We can use corresponding summary statistics calculated from our sample
  - Often called [**point estimates**]{style="color:#EF85B3;"} or [**sample statistics**]{style="color:#EF85B3;"}

 

- Much easier to measure statistics from our sample (Lesson 1)

  - However, statistics from our sample are not exactly the same as the population measurements that we're aiming for
  
  - We call the population measurements [**population parameters**]{style="color:#C83532;"}
  
 

- So we need to start by distinguishing between the population parameters and sample statistics


## Population parameters vs. sample statistics

::: columns
::: {.column width="50%"}

[__Population parameter__]{style="color:#C83532;"}

- Mean: $\mu$ ("mu")
- Standard deviation: $\sigma$ ("sigma")
- Variance: $\sigma^2$

 

- Proportion: $p$, $\pi$ ("pi")

 

- Correlation

:::

::: {.column width="50%"}
[__Sample statistic (point estimate)__]{style="color:#EF85B3;"}

- Sample mean: $\overline{x}$
- Sample standard deviation: $s$
- Sample variance: $s^2$

 

- Sample proportion: $\hat{p}$ ("p-hat")

 

- Sample correlation coefficient: $r$

:::
:::

## Poll Everywhere Question 1

# LO


## Population 

![](../img_slides/samp_dist_01.png){fig-align="center"}

## Take one sample

![](../img_slides/samp_dist_02.png){fig-align="center"}

## Take one sample

![](../img_slides/samp_dist_03.png){fig-align="center"}

## Take one sample

![](../img_slides/samp_dist_04.png){fig-align="center"}

## Take one sample

![](../img_slides/samp_dist_05.png){fig-align="center"}

## Take one sample

![](../img_slides/samp_dist_06.png){fig-align="center"}

## Take another sample

![](../img_slides/samp_dist_07.png){fig-align="center"}

## Take another sample

![](../img_slides/samp_dist_08.png){fig-align="center"}

## Take another sample

![](../img_slides/samp_dist_09.png){fig-align="center"}

## Take another sample

![](../img_slides/samp_dist_10.png){fig-align="center"}

## Take several samples

![](../img_slides/samp_dist_11.png){fig-align="center"}

## Difference between samples?

![](../img_slides/samp_dist_12.png){fig-align="center"}

# Learning Objective

## More concrete example with height

```{r}
#| echo: false
#| message: false

set.seed(4258)
n=10000000
height = rnorm(n, 65, 3)

heights = as.data.frame(cbind(1:n, height))

#density(height)
```

::: columns

::: {.column width="35%"}

Variation in population ($\sigma$):

 

```{r}
#| echo: false
#| fig-width: 7
#| fig-height: 4
heights %>% 
  ggplot(aes(x=height)) + 
  geom_density(color="black", fill="grey") +
  theme_classic() +
  labs(x="Height (inches)", y="Probability Density") +
  scale_x_continuous(breaks = seq(55, 75, by = 5), 
                     limits = c(55, 75)) +
  theme(text = element_text(size = 24))
```

$$ \mu = 65 \text{ inches}$$
$$ \sigma = 3 \text{ inches}$$
:::

::: {.column width="30%"}

:::

::: {.column width="35%"}

:::
:::



## More concrete example with height

::: columns

::: {.column width="35%"}
Variation in population ($\sigma$):

 

```{r}
#| echo: false
#| fig-width: 7
#| fig-height: 4
heights %>% 
  ggplot(aes(x=height)) + 
  geom_density(color="black", fill="grey") +
  theme_classic() +
  labs(x="Height (inches)", y="Probability Density") +
  scale_x_continuous(breaks = seq(55, 75, by = 5), 
                     limits = c(55, 75)) +
  theme(text = element_text(size = 24))
```

$$ \mu = 65 \text{ inches}$$
$$ \sigma = 3 \text{ inches}$$
:::

::: {.column width="30%"}

Variation within samples ($S$):

![](../img_slides/heights_samples.png){fig-align="center"}

:::

::: {.column width="35%"}

:::
:::



## More concrete example with height

::: columns

::: {.column width="35%"}

Variation in population ($\sigma$):

 

```{r}
#| echo: false
#| fig-width: 7
#| fig-height: 4
heights %>% 
  ggplot(aes(x=height)) + 
  geom_density(color="black", fill="grey") +
  theme_classic() +
  labs(x="Height (inches)", y="Probability Density") +
  scale_x_continuous(breaks = seq(55, 75, by = 5), 
                     limits = c(55, 75)) +
  theme(text = element_text(size = 24))
```

$$ \mu = 65 \text{ inches}$$
$$ \sigma = 3 \text{ inches}$$
:::

::: {.column width="30%"}

Variation within samples ($s$):

![](../img_slides/heights_samples.png){fig-align="center"}

:::

::: {.column width="35%"}

Variation between samples ($SE$):


 

```{r}
#| echo: false
#| fig-width: 7
#| fig-height: 4

means=NULL;sds=NULL
for(i in 1:1000){
  height = rnorm(50, 65, 3)
  means = c(means, mean(height))
  sds = c(sds, sd(height))
}
means = as.data.frame(cbind(1:1000, means, sds))

means %>% 
  ggplot(aes(x=means)) + 
  geom_histogram(color="black", fill="grey", bins=60) +
  labs(x="Mean height from samples (inches)", y="Frequency") +
  scale_x_continuous(breaks = seq(55, 75, by = 5), 
                     limits = c(55, 75)) +
  theme_classic() +
  theme(text = element_text(size = 24))

sample_mean = mean(means$means)
sample_sd = sd(means$means)
# 3/sqrt(50)
```

$$ \hat{\mu} = `r round(sample_mean, 3)` \text{ inches}$$
$$ SE = `r round(sample_sd, 3)` \text{ inches}$$

:::
:::

## Different variabilities


## Sampling Distribution of Sample Means

::: columns

::: {.column width="65%"}

- The __[sampling distribution]{style="color:#E75B5C"}__ is the distribution of sample means calculated from repeated random samples of _the same size_ from the same population

- It is useful to think of a particular point estimate as
being drawn from a sampling distribution

:::

::: {.column width="35%"}

Variation between samples ($SE$):


 

```{r}
#| echo: false
#| fig-width: 7
#| fig-height: 4

means=NULL;sds=NULL
for(i in 1:1000){
  height = rnorm(50, 65, 3)
  means = c(means, mean(height))
  sds = c(sds, sd(height))
}
means = as.data.frame(cbind(1:1000, means, sds))

means %>% 
  ggplot(aes(x=means)) + 
  geom_histogram(color="black", fill="grey", bins=60) +
  labs(x="Mean height from samples (inches)", y="Frequency") +
  scale_x_continuous(breaks = seq(55, 75, by = 5), 
                     limits = c(55, 75)) +
  theme_classic() +
  theme(text = element_text(size = 24))

sample_mean = mean(means$means)
sample_sd = sd(means$means)
# 3/sqrt(50)
```

$$ \hat{\mu} = `r round(sample_mean, 3)` \text{ inches}$$
$$ SE = `r round(sample_sd, 3)` \text{ inches}$$

:::
:::


## What happens if we have 10000 samples?

## Compare sampling distribution of 1,000 samples

How are the center, shape, and spread similar and/or different?

::: columns
::: {.column width="50%"}
```{r}
#| echo: false
#| fig-width: 9
#| fig-height: 6

means=NULL;sds=NULL
for(i in 1:1000){
  height = rnorm(50, 65, 3)
  means = c(means, mean(height))
  sds = c(sds, sd(height))
}
means50 = as.data.frame(cbind(1:1000, means, sds))

means50 %>% 
  ggplot(aes(x=means)) + 
  geom_histogram(color="black", fill="grey", bins=60) +
  labs(x="Mean height from samples (inches)", y="Frequency", 
       title="Sampling distribution (n=50)") +
  scale_x_continuous(breaks = seq(60, 70, by = 1), 
                     limits = c(63, 67)) +
  theme_classic() +
  theme(text = element_text(size = 24))

sample_mean = mean(means50$means)
sample_sd = sd(means50$means)
# 3/sqrt(50)
```

:::
::: {.column width="50%"}

```{r}
#| echo: false
#| fig-width: 9
#| fig-height: 6

means=NULL;sds=NULL
for(i in 1:1000){
  height = rnorm(100, 65, 3)
  means = c(means, mean(height))
  sds = c(sds, sd(height))
}
means100 = as.data.frame(cbind(1:1000, means, sds))

means100 %>% 
  ggplot(aes(x=means)) + 
  geom_histogram(color="black", fill="grey", bins=60) +
  labs(x="Mean height from samples (inches)", y="Frequency", 
       title="Sampling distribution (n=100)") +
  scale_x_continuous(breaks = seq(60, 70, by = 1), 
                     limits = c(63, 67)) +
  theme_classic() +
  theme(text = element_text(size = 24))

sample_mean = mean(means100$means)
sample_sd = sd(means100$means)
# 3/sqrt(50)
```
:::
:::

## Poll Everywhere question 

which plot is which?

# Learning Objectives


## The Central Limit Theorem (CLT) 

- If a sample consists of at least 30 independent observations, then the distribution of the sample mean is well approximated by a normal model

- Aka, for **"large" sample sizes** ( $n\geq 30$ ),
    * The __sampling distribution__ of the sample mean can be approximated by a __normal distribution__,with 
      * Mean equal to the population mean value $\mu$
      * Standard deviation $\frac{\sigma}{\sqrt{n}}$
      
- This is regardless of the original sample is from a different distribution
  - For example, if we count the number of heads in 50 coin flips, the sampling distribution of the sample mean will be ____-_____

## Other cases when sample can approximated with a normal distribution
* For **small sample sizes**, if the population is known to be normally distributed, then
    * the __sampling distribution__ of the sample mean
    * is a __normal distribution__, with 
      * Mean equal to the population mean value $\mu$, and 
      * Standard deviation $\frac{\sigma}{\sqrt{n}}$

## Sampling distribution of mean heights when n = 50 (1/2)
::: columns
::: {.column width="50%"}
:::

::: {.column width="50%"}
CLT tells us that we can model the sampling distribution of mean heights using a normal distribution:
:::
:::

::: columns
::: {.column width="50%"}
```{r}
#| echo: false  
#| fig.height: 6
#| fig.width: 8

means50 %>% 
  ggplot(aes(x=means)) + 
  geom_histogram(color="black", fill="grey", bins=60) +
  labs(x="Mean height from samples (inches)", y="Frequency",  
       title = "Sampling distribution of sample means") +
  scale_x_continuous(breaks = seq(60, 70, by = 1), 
                     limits = c(63, 67)) +
  theme(text = element_text(size = 24))
```

:::
::: {.column width="50%"}

```{r}
#| echo: false
#| fig.height: 6
#| fig.width: 8
mu <- 65
SE <- 3/sqrt(50)
sig <- round(SE, 2)

# sig
# mu+sig
# mu+2*sig
# mu-sig
# mu-2*sig

gg_samp_dist_heights <- ggplot(data.frame(x = c(mu-4*sig, mu+4*sig)), aes(x = x)) + 
  stat_function(fun = dnorm, 
                args = list(mean = mu, sd = sig), 
                xlim = c(mu-4*sig, mu-2*sig), 
                geom = "area", fill = "#C83532") +
  stat_function(fun = dnorm, 
                args = list(mean = mu, sd = sig), 
                xlim = c(mu+2*sig, mu+4*sig), 
                geom = "area", fill = "#C83532") +
  stat_function(fun = dnorm, 
                args = list(mean = mu, sd = sig), 
                xlim = c(mu-2*sig, mu-1*sig), 
                geom = "area", fill = "#5BAFF8") +
  stat_function(fun = dnorm, 
                args = list(mean = mu, sd = sig), 
                xlim = c(mu+1*sig, mu+2*sig), 
                geom = "area", fill = "#5BAFF8")+
  stat_function(fun = dnorm, 
                args = list(mean = mu, sd = sig), 
                xlim = c(mu-1*sig, mu+1*sig), 
                geom = "area", fill = "#EF85B3") +
  stat_function(fun = dnorm, 
                args = list(mean = mu, sd = sig), 
                size = 2) + 
  scale_x_continuous(name ="Mean height from samples (inches)", 
                    breaks=c(mu-2*sig,mu-1*sig,mu, mu+1*sig, mu+2*sig)) +
  labs(title = "Sampling distribution", y = "") +
  scale_y_continuous(labels = NULL, breaks = NULL) +
  theme(text = element_text(size = 24))


gg_samp_dist_heights   
```
:::
:::


## Sampling distribution of mean heights when n = 50 (2/2)
::: columns
::: {.column width="65%"}
Mean and SD of **population**:
$$ \mu = 65 \text{ inches}$$
$$ \sigma = 3 \text{ inches}$$

From the CLT, we can figure out the mean and standard deviation of our sampling distribution:

$$ \mu = 65 \text{ inches}$$
$$ SE = \frac{\sigma}{\sqrt{n}} \text{ inches} = \frac{3}{\sqrt{50}} \text{ inches} = 0.424 \text{ inches}$$

Sampling mean and sampling SD of **simulated** sampling distribution:

```{r}
(sample_mean = mean(means50$means))
(sample_sd = sd(means50$means))
```
:::
::: {.column width="35%"}
```{r}
#| echo: false
#| fig.height: 4
#| fig.width: 7
gg_samp_dist_heights +
  theme(text=element_text(size=20))
```
:::
:::


## Why is the mean $\mu$ & the standard error $\frac{\sigma}{\sqrt{n}}$ ?



## Applying the CLT

What is the probability that for a random sample of 30 high schoolers, that their mean height is greater than 5.6 ft?

## Summary Review: Point Estimate Terminology

- **Population mean**: $\mu$
- **Population standard deviation**: $\sigma$
- **Sample mean**: $\overline{x}$
- **Sample standard deviation**: $s$
- **Sampling distribution**: Distribution of sample means for repeated samples.
  - Use $\overline{X}$ as the RV for this distribution
  - $\overline{X} \sim \text{Normal} \bigg(\mu_{\overline{X}} = \mu, \sigma_{\overline{X}}= SE = \frac{s}{\sqrt{n}} \bigg)$
- **Standard error (SE)**: The standard deviation of the sampling distribution.
    - Formula: $SE = \frac{s}{\sqrt{n}}$

## Check out this video explanation of CLT

* [Bunnies, Dragons and the 'Normal' World: Central Limit Theorem]{style="color:#BF396F"}
    * Creature Cast from the New York Times
    * [https://www.youtube.com/watch?v=jvoxEYmQHNM&feature=youtu.be](https://www.youtube.com/watch?v=jvoxEYmQHNM&feature=youtu.be)

![](../img_slides/CLT_video_preview.png){fig-align="center" width=80%}


