---
title: "Lesson 9: Variability in estimates"
subtitle: "TB sections 4.1"
author: "Meike Niederhausen and Nicky Wakim"
title-slide-attributes:
    data-background-color: "#3070BF"
date: "10/28/2024"
format: 
  revealjs:
    theme: "../simple_NW.scss"
    chalkboard: true
    slide-number: true
    show-slide-number: all
    width: 1955
    height: 1100
    footer: Lesson 9 Slides
    html-math-method: mathjax
    highlight-style: arrow
execute:
  echo: true
  freeze: auto
---


```{r}
#| label: "setup" 
#| include: false
#| message: false
#| warning: false

library(tidyverse)
library(janitor)
library(rstatix)
library(oibiostat) 
library(knitr)
library(moderndive) # NEW!!
library(ggplot2)
library(dplyr)

# terminal: for icons
# quarto install extension quarto-ext/fontawesome

# set ggplot theme for slides 
theme_set(theme_bw(base_size = 22))
# theme_update(text = element_text(size=16))  # set global text size for ggplots

set.seed(456)
```

```{css, echo=FALSE}
.reveal code {
  max-height: 100% !important;
}
```

# Learning Objectives
1. Understand that a single sample may not be a perfect representation of the population

2. Illustrate how information from several samples are connected to the population

  - There is variation between samples

3. Learn characteristics of the Sampling Distribution of Sample Means

  - Mean of the sampling distribution is the same as mean of population

4. Distinguish different language referring to different variabilities

  - Variability of the population
  - Variability within a sample 
  - Variability between samples 

5. Solidify what we learn about sampling distributions through coding and visualizing in Rstudio Cloud


## Where are we?

![](../img_slides/course_map.png){fig-align="center"}

## Summary: Point Estimate Terminology

- **Population mean**: $\mu$
- **Population standard deviation**: $\sigma$
- **Sample mean**: $\overline{x}$
- **Sample standard deviation**: $s$
- **Sampling distribution**: Distribution of sample means for repeated samples.
- **Standard error (SE)**: The standard deviation of the sampling distribution.
    - Formula: $SE = \frac{s}{\sqrt{n}}$

## Goals for today

__Section 4.1__

* Sampling from a population
  * population parameters vs. point estimates
  * sampling variation

* Sampling distribution of the mean
  * Central Limit Theorem
  * Standard error of the mean

![[Artwork by @allison_horst](https://allisonhorst.com/)](../img_slides/horst_samples.png){fig-align="center"}


## From Lesson 1: Population vs. sample

::: columns
::: column

::: red
::: red-ttl
(Target) Population
:::
::: red-cont
* Group of interest being studied
* Group from which the sample is selected
  - Studies often have _inclusion_ and/or _exclusion_ criteria
* Almost always too expensive or logistically impossible to collect data for every case in a population
  
:::
:::
:::

::: column
::: pink
::: pink-ttl
Sample
::: 
::: pink-cont
* Group on which data are collected
* Often a **small subset** of the population
* Easier to collect data on 
* If we do it right, we might be able to answer our question about the target population
:::
:::

:::
:::

## From Lesson 1: Sampling 

- Goal is to get a __representative__ sample of the population: the characteristics of the sample are similar to the characteristics of the population
- There are different ways to sample from a target population
- Types of sampling that we discuss
    - Simple random sample (SRS)
    - Convenient sample
    - Stratified sample
    - Cluster sample
    - Multistage sample
    
## Why sample statistics?

- When we want to estimate features of the population

  - We can use corresponding summary statistics calculated from our sample

 

- Much easier to measure statistics from our sample (Lesson 1)

  - However, statistics from our sample are not exactly the same as the population measurements that we're aiming for
  
  - We call the population measurements **population parameters**
  
 

- So we need to start by distinguishing between the population parameters and sample statistics


## Population parameters vs. sample statistics

::: columns
::: {.column width="50%"}

[__Population parameter__]{style="color:#C83532;"}

- Mean: $\mu$ ("mu")
- Standard deviation: $\sigma$ ("sigma")
- Variance: $\sigma^2$

 

- Proportion: $p$, $\pi$ ("pi")

 

- Correlation

:::

::: {.column width="50%"}
[__Sample statistic (point estimate)__]{style="color:#EF85B3;"}

- Sample mean: $\overline{x}$
- Sample standard deviation: $s$
- Sample variance: $s^2$

 

- Sample proportion: $\hat{p}$ ("p-hat")

 

- Sample correlation coefficient: $r$

:::
:::

## Poll Everywhere Question 1

# Sampling variation
Build the intuition around samplign variation

## Population 

![](../img_slides/samp_dist_01.png){fig-align="center"}

## Take one sample

![](../img_slides/samp_dist_02.png){fig-align="center"}

## Take one sample

![](../img_slides/samp_dist_03.png){fig-align="center"}

## Take one sample

![](../img_slides/samp_dist_04.png){fig-align="center"}

## Take one sample

![](../img_slides/samp_dist_05.png){fig-align="center"}

## Take one sample

![](../img_slides/samp_dist_06.png){fig-align="center"}

## Take another sample

![](../img_slides/samp_dist_07.png){fig-align="center"}

## Take another sample

![](../img_slides/samp_dist_08.png){fig-align="center"}

## Take another sample

![](../img_slides/samp_dist_09.png){fig-align="center"}

## Take another sample

![](../img_slides/samp_dist_10.png){fig-align="center"}

## Take several samples

![](../img_slides/samp_dist_11.png){fig-align="center"}

## Difference between samples?

![](../img_slides/samp_dist_12.png){fig-align="center"}


## More concrete example with height

```{r}
#| echo: false
#| message: false

set.seed(4258)
n=10000000
height = rnorm(n, 65, 3)

heights = as.data.frame(cbind(1:n, height))

#density(height)
```

::: columns

::: {.column width="35%"}

Variation in population ($\sigma$):

 

```{r}
#| echo: false
#| fig-width: 7
#| fig-height: 4
heights %>% 
  ggplot(aes(x=height)) + 
  geom_density(color="black", fill="grey") +
  theme_classic() +
  labs(x="Height (inches)", y="Probability Density") +
  scale_x_continuous(breaks = seq(55, 75, by = 5), 
                     limits = c(55, 75)) +
  theme(text = element_text(size = 24))
```

$$ \mu = 65 \text{ inches}$$
$$ \sigma = 3 \text{ inches}$$
:::

::: {.column width="30%"}

:::

::: {.column width="35%"}

:::
:::



## More concrete example with height

::: columns

::: {.column width="35%"}
Variation in population ($\sigma$):

 

```{r}
#| echo: false
#| fig-width: 7
#| fig-height: 4
heights %>% 
  ggplot(aes(x=height)) + 
  geom_density(color="black", fill="grey") +
  theme_classic() +
  labs(x="Height (inches)", y="Probability Density") +
  scale_x_continuous(breaks = seq(55, 75, by = 5), 
                     limits = c(55, 75)) +
  theme(text = element_text(size = 24))
```

$$ \mu = 65 \text{ inches}$$
$$ \sigma = 3 \text{ inches}$$
:::

::: {.column width="30%"}

Variation within samples ($S$):

![](../img_slides/heights_samples.png){fig-align="center"}

:::

::: {.column width="35%"}

:::
:::



## More concrete example with height

::: columns

::: {.column width="35%"}

Variation in population ($\sigma$):

 

```{r}
#| echo: false
#| fig-width: 7
#| fig-height: 4
heights %>% 
  ggplot(aes(x=height)) + 
  geom_density(color="black", fill="grey") +
  theme_classic() +
  labs(x="Height (inches)", y="Probability Density") +
  scale_x_continuous(breaks = seq(55, 75, by = 5), 
                     limits = c(55, 75)) +
  theme(text = element_text(size = 24))
```

$$ \mu = 65 \text{ inches}$$
$$ \sigma = 3 \text{ inches}$$
:::

::: {.column width="30%"}

Variation within samples ($S$):

![](../img_slides/heights_samples.png){fig-align="center"}

:::

::: {.column width="35%"}

Variation between samples ($SE$):


 

```{r}
#| echo: false
#| fig-width: 7
#| fig-height: 4

means=NULL;sds=NULL
for(i in 1:1000){
  height = rnorm(50, 65, 3)
  means = c(means, mean(height))
  sds = c(sds, sd(height))
}
means = as.data.frame(cbind(1:1000, means, sds))

means %>% 
  ggplot(aes(x=means)) + 
  geom_histogram(color="black", fill="grey", bins=60) +
  labs(x="Mean height from samples (inches)", y="Frequency") +
  scale_x_continuous(breaks = seq(55, 75, by = 5), 
                     limits = c(55, 75)) +
  theme_classic() +
  theme(text = element_text(size = 24))

sample_mean = mean(means$means)
sample_sd = sd(means$means)
# 3/sqrt(50)
```

$$ \hat{\mu} = `r round(sample_mean, 3)` \text{ inches}$$
$$ SE = `r round(sample_sd, 3)` \text{ inches}$$

:::
:::

## Different variabilities


## Sampling Distribution of Sample Means

* The __[sampling distribution]{style="color:darkorang"}__ of the mean is the distribution of sample means calculated from repeated random samples of _the same size_ from the same population

* Our simulations show approximations of the sampling distribution of the mean for various sample sizes

* The theoretical sampling distribution is based on all possible samples of a given sample size $n$.

## What happens if we have 10000 samples?

## Compare sampling distribution of 1000 samples for n=50 (left) and n=100 (right)

[How are the center, shape, and spread similar and/or different?]{style="color:purple"}

::: columns
::: {.column width="50%"}
```{r}
#| echo: false
#| fig-width: 7
#| fig-height: 4

means=NULL;sds=NULL
for(i in 1:1000){
  height = rnorm(50, 65, 3)
  means = c(means, mean(height))
  sds = c(sds, sd(height))
}
means50 = as.data.frame(cbind(1:1000, means, sds))

means50 %>% 
  ggplot(aes(x=means)) + 
  geom_histogram(color="black", fill="grey", bins=60) +
  labs(x="Mean height from samples (inches)", y="Frequency") +
  scale_x_continuous(breaks = seq(55, 75, by = 5), 
                     limits = c(55, 75)) +
  theme_classic() +
  theme(text = element_text(size = 24))

sample_mean = mean(means50$means)
sample_sd = sd(means50$means)
# 3/sqrt(50)
```

:::
::: {.column width="50%"}

```{r}
#| echo: false
#| fig-width: 7
#| fig-height: 4

means=NULL;sds=NULL
for(i in 1:1000){
  height = rnorm(100, 65, 3)
  means = c(means, mean(height))
  sds = c(sds, sd(height))
}
means100 = as.data.frame(cbind(1:1000, means, sds))

means100 %>% 
  ggplot(aes(x=means)) + 
  geom_histogram(color="black", fill="grey", bins=60) +
  labs(x="Mean height from samples (inches)", y="Frequency") +
  scale_x_continuous(breaks = seq(55, 75, by = 5), 
                     limits = c(55, 75)) +
  theme_classic() +
  theme(text = element_text(size = 24))

sample_mean = mean(means100$means)
sample_sd = sd(means100$means)
# 3/sqrt(50)
```
:::
:::

## Poll Everywhere question 

## The Central Limit Theorem (CLT) 

* For **"large" sample sizes** ( $n\geq 30$ ),
    * the __sampling distribution__ of the sample mean
    * can be approximated by a __normal distribution__,with 
      * _mean_ equal to the _population mean_ value $\mu$, and 
      * _standard deviation_ $\frac{\sigma}{\sqrt{n}}$

<!-- $$\bar{X}\sim N(\mu_{\bar{X}} = \ \ \ \ \ \ \ \ \ \ \ , \sigma_{\bar{X}}= \ \ \ \ \ \ \ \ \ \ \ )$$ -->
<br>
<br>
<br>

* For **small sample sizes**, if the population is known to be normally distributed, then
    * the __sampling distribution__ of the sample mean
    * is a __normal distribution__, with 
      * _mean_ equal to the _population mean_ value $\mu$, and 
      * _standard deviation_ $\frac{\sigma}{\sqrt{n}}$


## The cutest statistics video on YouTube

* _[Bunnies, Dragons and the 'Normal' World: Central Limit Theorem]{style="color:purple"}_ 
    * Creature Cast from the New York Times
    * [https://www.youtube.com/watch?v=jvoxEYmQHNM&feature=youtu.be](https://www.youtube.com/watch?v=jvoxEYmQHNM&feature=youtu.be)

![](../img_slides/CLT_video_preview.png){fig-align="center" width=80%}



## Sampling distribution of mean heights when n = 50 (1/2)
::: columns
::: {.column width="50%"}
```{r}
#| echo: false  
#| fig.height: 4
#| fig.width: 7

means50 %>% 
  ggplot(aes(x=means)) + 
  geom_histogram(color="black", fill="grey", bins=60) +
  labs(x="Mean height from samples (inches)", y="Frequency") +
  scale_x_continuous(breaks = seq(55, 75, by = 5), 
                     limits = c(55, 75)) +
  theme_classic() +
  theme(text = element_text(size = 24))
```

:::
::: {.column width="50%"}

CLT tells us that we can model the sampling distribution of mean heights using a normal distribution.

```{r}
#| echo: false
#| fig.height: 5.5
#| fig.width: 6
mu <- 65
SE <- 3/sqrt(50)
sig <- round(SE, 2)

# sig
# mu+sig
# mu+2*sig
# mu-sig
# mu-2*sig

gg_samp_dist_heights <- ggplot(data.frame(x = c(mu-4*sig, mu+4*sig)), aes(x = x)) + 
  stat_function(fun = dnorm, 
                args = list(mean = mu, sd = sig)) + 
  stat_function(fun = dnorm, 
                args = list(mean = mu, sd = sig), 
                xlim = c(mu-4*sig, mu-2*sig), 
                geom = "area", fill = "darkblue") +
  stat_function(fun = dnorm, 
                args = list(mean = mu, sd = sig), 
                xlim = c(mu+2*sig, mu+4*sig), 
                geom = "area", fill = "darkblue") +
  stat_function(fun = dnorm, 
                args = list(mean = mu, sd = sig), 
                xlim = c(mu-2*sig, mu-1*sig), 
                geom = "area", fill = "darkgreen") +
  stat_function(fun = dnorm, 
                args = list(mean = mu, sd = sig), 
                xlim = c(mu+1*sig, mu+2*sig), 
                geom = "area", fill = "darkgreen")+
  stat_function(fun = dnorm, 
                args = list(mean = mu, sd = sig), 
                xlim = c(mu-1*sig, mu+1*sig), 
                geom = "area", fill = "orange") +
  scale_x_continuous(name ="mean height (ft)", 
                    breaks=c(mu-2*sig,mu-1*sig,mu, mu+1*sig, mu+2*sig)) +
  labs(title = "Sampling distribution", y = "") +
  scale_y_continuous(labels = NULL, breaks = NULL)

gg_samp_dist_heights   
```
:::
:::


## Sampling distribution of mean heights when n = 30 (2/2)
::: columns
::: {.column width="65%"}
Mean and SD of population:
$$ \mu = 65 \text{ inches}$$
$$ \sigma = 3 \text{ inches}$$

```{r}
3/sqrt(50)
```

Sampling mean and sampling SD of simulated sampling distribution:

```{r}
(sample_mean = mean(means50$means))
(sample_sd = sd(means50$means))
```
:::
::: {.column width="35%"}
```{r}
#| echo: false
#| fig.height: 4
#| fig.width: 7
gg_samp_dist_heights +
  theme(text=element_text(size=15))
```
:::
:::


## Why is the mean $\mu$ & the standard error $\frac{\sigma}{\sqrt{n}}$ ?



## Applying the CLT

What is the probability that for a random sample of 30 high schoolers, that their mean height is greater than 5.6 ft?


## Class Discussion

* Slide 21: match figures to distribution (Sampling high schoolers' weights)

Problems from Homework 4:

* R1: Youth weights (YRBSS)
* Book exercise: 4.2
* Non-book exercise: Ethan Allen



